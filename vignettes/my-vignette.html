<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>my-vignette</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">my-vignette</h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(blblm)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(parallel)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">#&gt; -- Attaching packages --------------------------------------- tidyverse 1.3.0 --</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">#&gt; v ggplot2 3.3.0     v purrr   0.3.4</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co">#&gt; v tibble  3.0.1     v dplyr   0.8.5</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co">#&gt; v tidyr   1.0.3     v stringr 1.4.0</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co">#&gt; v readr   1.3.1     v forcats 0.5.0</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co">#&gt; -- Conflicts ------------------------------------------ tidyverse_conflicts() --</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co">#&gt; x dplyr::filter() masks blblm::filter(), stats::filter()</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="co">#&gt; x dplyr::lag()    masks blblm::lag(), stats::lag()</span></a></code></pre></div>
<p>For this specific project, we are required to improve the blblm package, which is used for Linear Regression with Little Bag of Bootstraps.<br> Therefore, I first started looking at the parallel function from part 1 of the requirements.<br> The following is the original function blblm:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="co">#&#39; Generate linear regression with boostrap</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="co">#&#39;</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="co">#&#39; @param formula regression formula</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co">#&#39; @param data the data you want to regression</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co">#&#39; @param m number of subdata</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="co">#&#39; @param B number of bootstrips</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="co">#&#39;</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="co">#&#39; @return blblm</span></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="co">#&#39; @export</span></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="co">#&#39; @examples</span></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="co">#&#39; blblm(mpg ~ wt * hp, data = mtcars, m = 3, B = 100)</span></a>
<a class="sourceLine" id="cb2-12" title="12">blblm &lt;-<span class="st"> </span><span class="cf">function</span>(formula, data, <span class="dt">m =</span> m, <span class="dt">B =</span> B) {</a>
<a class="sourceLine" id="cb2-13" title="13">  data_list &lt;-<span class="st"> </span><span class="kw">split_data</span>(data, m)</a>
<a class="sourceLine" id="cb2-14" title="14">  estimates &lt;-<span class="st"> </span><span class="kw">map</span>(</a>
<a class="sourceLine" id="cb2-15" title="15">    data_list,</a>
<a class="sourceLine" id="cb2-16" title="16">    <span class="op">~</span><span class="st"> </span><span class="kw">lm_each_subsample</span>(<span class="dt">formula =</span> formula, <span class="dt">data =</span> ., <span class="dt">n =</span> <span class="kw">nrow</span>(data), <span class="dt">B =</span> B))</a>
<a class="sourceLine" id="cb2-17" title="17">  res &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">estimates =</span> estimates, <span class="dt">formula =</span> formula)</a>
<a class="sourceLine" id="cb2-18" title="18">  <span class="kw">class</span>(res) &lt;-<span class="st"> &quot;blblm&quot;</span></a>
<a class="sourceLine" id="cb2-19" title="19">  <span class="kw">invisible</span>(res)</a>
<a class="sourceLine" id="cb2-20" title="20">}</a></code></pre></div>
<p>First of all, I added title and paramed the variables. I also used the built in dataset to create a example for the function.<br> From this chunk of code, intuitively, I understand that I need to change map() function to parLapply(). Therefore, I did following:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">blblm &lt;-<span class="st"> </span><span class="cf">function</span>(formula, data, <span class="dt">m =</span> m, <span class="dt">B =</span> B) {</a>
<a class="sourceLine" id="cb3-2" title="2">  data_list &lt;-<span class="st"> </span><span class="kw">split_data</span>(data, m)</a>
<a class="sourceLine" id="cb3-3" title="3">  estimates &lt;-<span class="st"> </span><span class="kw">parLapply</span>(</a>
<a class="sourceLine" id="cb3-4" title="4">    data_list,</a>
<a class="sourceLine" id="cb3-5" title="5">    <span class="kw">lm_each_subsample</span>(<span class="dt">formula =</span> formula, <span class="dt">data =</span> ., <span class="dt">n =</span> <span class="kw">nrow</span>(data), <span class="dt">B =</span> B))</a>
<a class="sourceLine" id="cb3-6" title="6">  res &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">estimates =</span> estimates, <span class="dt">formula =</span> formula)</a>
<a class="sourceLine" id="cb3-7" title="7">  <span class="kw">class</span>(res) &lt;-<span class="st"> &quot;blblm&quot;</span></a>
<a class="sourceLine" id="cb3-8" title="8">  <span class="kw">invisible</span>(res)</a>
<a class="sourceLine" id="cb3-9" title="9">}</a></code></pre></div>
<p>However, it did not work out. After struggling for a hour, I find out the following code is working:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co">#&#39; Generate linear regression with boostrap</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="co">#&#39;</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">#&#39; @param formula regression formula</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co">#&#39; @param data data we are dealing with</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co">#&#39; @param m number of subdata</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">#&#39; @param B number of bootstrips</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co">#&#39; @param cl cluster/integer</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="co">#&#39;</span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co">#&#39; @return blblm_par</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="co">#&#39; @export</span></a>
<a class="sourceLine" id="cb4-11" title="11">blblm_par &lt;-<span class="st"> </span><span class="cf">function</span>(formula, data, <span class="dt">m =</span> m, <span class="dt">B =</span> B,cl) {</a>
<a class="sourceLine" id="cb4-12" title="12">  data_list &lt;-<span class="st"> </span><span class="kw">split_data</span>(data, m)</a>
<a class="sourceLine" id="cb4-13" title="13">  estimates &lt;-<span class="st"> </span><span class="kw">parLapply</span>(cl,data_list,<span class="dt">fun=</span>lm_each_subsample,<span class="dt">formula =</span> formula, <span class="dt">n =</span> <span class="kw">nrow</span>(data), <span class="dt">B =</span> B)</a>
<a class="sourceLine" id="cb4-14" title="14">  res &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">estimates =</span> estimates, <span class="dt">formula =</span> formula)</a>
<a class="sourceLine" id="cb4-15" title="15">  <span class="kw">class</span>(res) &lt;-<span class="st"> &quot;blblm&quot;</span></a>
<a class="sourceLine" id="cb4-16" title="16">  <span class="kw">invisible</span>(res)</a>
<a class="sourceLine" id="cb4-17" title="17">}</a></code></pre></div>
<p>Since we should not create cluster in our package, I only set cl variable as the cluster. Users are responsible of creating and stopping the clusters. AS we all know that parallel function is faster than map() function while dealing large dataset.<br> Though this chunk is viable, it did not work at the time I wrote it. After hours of debugging, I realized that the function lm_each_subsample contains several function, such as lm_each_boot, lm1, and lm. I could not run my parallel function without exporting them. Therefore, I did the following:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co">#&#39; compute the estimates</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="co">#&#39; @param formula regression formula</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co">#&#39; @param n integer</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="co">#&#39; @param B number of bootstrips</span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="co">#&#39; @param data data we are dealing with</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="co">#&#39; @export</span></a>
<a class="sourceLine" id="cb5-7" title="7">lm_each_subsample &lt;-<span class="st"> </span><span class="cf">function</span>(formula, data, n, B) {</a>
<a class="sourceLine" id="cb5-8" title="8">  <span class="kw">replicate</span>(B, <span class="kw">lm_each_boot</span>(formula, data, n), <span class="dt">simplify =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb5-9" title="9">}</a>
<a class="sourceLine" id="cb5-10" title="10"></a>
<a class="sourceLine" id="cb5-11" title="11"><span class="co">#&#39; compute the regression estimates for a blb dataset</span></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="co">#&#39; @param formula regression formula</span></a>
<a class="sourceLine" id="cb5-13" title="13"><span class="co">#&#39; @param data data we are dealing with</span></a>
<a class="sourceLine" id="cb5-14" title="14"><span class="co">#&#39; @param n integer</span></a>
<a class="sourceLine" id="cb5-15" title="15"><span class="co">#&#39; @export</span></a>
<a class="sourceLine" id="cb5-16" title="16">lm_each_boot &lt;-<span class="st"> </span><span class="cf">function</span>(formula, data, n) {</a>
<a class="sourceLine" id="cb5-17" title="17">  freqs &lt;-<span class="st"> </span><span class="kw">rmultinom</span>(<span class="dv">1</span>, n, <span class="kw">rep</span>(<span class="dv">1</span>, <span class="kw">nrow</span>(data)))</a>
<a class="sourceLine" id="cb5-18" title="18">  <span class="kw">lm1</span>(formula, data, freqs)</a>
<a class="sourceLine" id="cb5-19" title="19">}</a>
<a class="sourceLine" id="cb5-20" title="20"></a>
<a class="sourceLine" id="cb5-21" title="21"></a>
<a class="sourceLine" id="cb5-22" title="22"><span class="co">#&#39; estimate the regression estimates based on given the number of repetitions</span></a>
<a class="sourceLine" id="cb5-23" title="23"><span class="co">#&#39; @param formula regression formula</span></a>
<a class="sourceLine" id="cb5-24" title="24"><span class="co">#&#39; @param data data we are dealing with</span></a>
<a class="sourceLine" id="cb5-25" title="25"><span class="co">#&#39; @param freqs frequency</span></a>
<a class="sourceLine" id="cb5-26" title="26"><span class="co">#&#39; @export</span></a>
<a class="sourceLine" id="cb5-27" title="27">lm1 &lt;-<span class="st"> </span><span class="cf">function</span>(formula, data, freqs) {</a>
<a class="sourceLine" id="cb5-28" title="28">  <span class="co"># drop the original closure of formula,</span></a>
<a class="sourceLine" id="cb5-29" title="29">  <span class="co"># otherwise the formula will pick a wront variable from the global scope.</span></a>
<a class="sourceLine" id="cb5-30" title="30">  <span class="kw">environment</span>(formula) &lt;-<span class="st"> </span><span class="kw">environment</span>()</a>
<a class="sourceLine" id="cb5-31" title="31">  object &lt;-<span class="st"> </span><span class="kw">lm</span>(formula, data, <span class="dt">weights =</span> freqs)</a>
<a class="sourceLine" id="cb5-32" title="32">  <span class="kw">list</span>(<span class="dt">coef =</span> <span class="kw">blbcoef</span>(object), <span class="dt">sigma =</span> <span class="kw">blbsigma</span>(object))</a>
<a class="sourceLine" id="cb5-33" title="33">}</a></code></pre></div>
<p>I added title and paramed variables, then I exported these functions. Noted that after I finished doing these, I potentially eliminated many warning from check() later.<br> After I export all these functions, I can run my parallel function. Also, it was the time that I can do a check() with no errors.<br> My next goal was to get rid of warnings and notes. Thus, I added following at the top of my R file:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="co">#&#39; @importFrom utils capture.output</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="co">#&#39; @aliases NULL</span></a></code></pre></div>
<p>These trivial things are often causing bugs if we do not think carefully.<br> Also, I fixed typo in the code: “fit” to “object” in blbcoef and blbsigma function.<br> After I achieved 0 error, 0 warning, and 0 note, I tried to complete my R package.<br> Then, I wrote my DESCRIPTION and use_mit_license().<br> after that, I was able to do another model for the package.<br> I chose to do generalized linear regression model.<br> First of all, I found the lm() function to begin with.<br> glm(formula, data, weights = freqs,family = gaussian)<br> after doing glm(), I goes to the higher function:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co">#&#39; estimate the regression estimates based on given the number of repetitions</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="co">#&#39; @param formula regression formula</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="co">#&#39; @param data data we are dealing with</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="co">#&#39; @param freqs frequency</span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co">#&#39; @export</span></a>
<a class="sourceLine" id="cb7-6" title="6">glm1 &lt;-<span class="st"> </span><span class="cf">function</span>(formula, data, freqs) {</a>
<a class="sourceLine" id="cb7-7" title="7">  <span class="co"># drop the original closure of formula,</span></a>
<a class="sourceLine" id="cb7-8" title="8">  <span class="co"># otherwise the formula will pick a wront variable from the global scope.</span></a>
<a class="sourceLine" id="cb7-9" title="9">  <span class="kw">environment</span>(formula) &lt;-<span class="st"> </span><span class="kw">environment</span>()</a>
<a class="sourceLine" id="cb7-10" title="10">  object &lt;-<span class="st"> </span><span class="kw">glm</span>(formula, data, <span class="dt">weights =</span> freqs,<span class="dt">family =</span> gaussian)</a>
<a class="sourceLine" id="cb7-11" title="11">  coef =<span class="st"> </span><span class="kw">blbcoef</span>(object) <span class="co">#glm does not have sigma</span></a>
<a class="sourceLine" id="cb7-12" title="12">}</a></code></pre></div>
<p>This is a independent function, and I exported it for later. <br> Then, I worked with next one:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="co">#&#39; compute the regression estimates for a blb dataset</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="co">#&#39; @param formula regression formula</span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="co">#&#39; @param data data we are dealing with</span></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="co">#&#39; @param n integer</span></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="co">#&#39; @export</span></a>
<a class="sourceLine" id="cb8-6" title="6">glm_each_boot &lt;-<span class="st"> </span><span class="cf">function</span>(formula, data, n) {</a>
<a class="sourceLine" id="cb8-7" title="7">  freqs &lt;-<span class="st"> </span><span class="kw">rmultinom</span>(<span class="dv">1</span>, n, <span class="kw">rep</span>(<span class="dv">1</span>, <span class="kw">nrow</span>(data)))</a>
<a class="sourceLine" id="cb8-8" title="8">  <span class="kw">glm1</span>(formula, data, freqs)</a>
<a class="sourceLine" id="cb8-9" title="9">}</a></code></pre></div>
<p>Then:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co">#&#39; compute the estimates</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="co">#&#39; @param formula regression formula</span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="co">#&#39; @param n integer</span></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="co">#&#39; @param B number of bootstrips</span></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="co">#&#39; @param data data we are dealing with</span></a>
<a class="sourceLine" id="cb9-6" title="6"><span class="co">#&#39; @export</span></a>
<a class="sourceLine" id="cb9-7" title="7">glm_each_subsample &lt;-<span class="st"> </span><span class="cf">function</span>(formula, data, n, B) {</a>
<a class="sourceLine" id="cb9-8" title="8">  <span class="kw">replicate</span>(B, <span class="kw">glm_each_boot</span>(formula, data, n), <span class="dt">simplify =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb9-9" title="9">}</a></code></pre></div>
<p>Eventually, I complete the glm version of blblm:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="co">#&#39; Generate linear regression with boostrap</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="co">#&#39;</span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="co">#&#39; @param formula regression formula</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="co">#&#39; @param data the data you want to regression</span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="co">#&#39; @param m number of subdata</span></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="co">#&#39; @param B number of bootstrips</span></a>
<a class="sourceLine" id="cb10-7" title="7"><span class="co">#&#39;</span></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="co">#&#39; @return blblm</span></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="co">#&#39; @export</span></a>
<a class="sourceLine" id="cb10-10" title="10"><span class="co">#&#39; @examples</span></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="co">#&#39; blblm_glm(mpg ~ wt * hp, data = mtcars, m = 3, B = 100)</span></a>
<a class="sourceLine" id="cb10-12" title="12">blblm_glm &lt;-<span class="st"> </span><span class="cf">function</span>(formula, data, <span class="dt">m =</span> m, <span class="dt">B =</span> B) {</a>
<a class="sourceLine" id="cb10-13" title="13">  data_list &lt;-<span class="st"> </span><span class="kw">split_data</span>(data, m)</a>
<a class="sourceLine" id="cb10-14" title="14">  estimates &lt;-<span class="st"> </span><span class="kw">map</span>(</a>
<a class="sourceLine" id="cb10-15" title="15">    data_list,</a>
<a class="sourceLine" id="cb10-16" title="16">    <span class="op">~</span><span class="st"> </span><span class="kw">glm_each_subsample</span>(<span class="dt">formula =</span> formula, <span class="dt">data =</span> ., <span class="dt">n =</span> <span class="kw">nrow</span>(data), <span class="dt">B =</span> B))</a>
<a class="sourceLine" id="cb10-17" title="17">  res &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">estimates =</span> estimates, <span class="dt">formula =</span> formula)</a>
<a class="sourceLine" id="cb10-18" title="18">  <span class="kw">class</span>(res) &lt;-<span class="st"> &quot;blblm&quot;</span></a>
<a class="sourceLine" id="cb10-19" title="19">  <span class="kw">invisible</span>(res)</a>
<a class="sourceLine" id="cb10-20" title="20">}</a></code></pre></div>
<p>Then, I know if I can make a parallel function, it would be better:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co">#&#39; Generate linear regression with boostrap</span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="co">#&#39;</span></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="co">#&#39; @param formula regression formula</span></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="co">#&#39; @param data data we are dealing with</span></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="co">#&#39; @param m number of subdata</span></a>
<a class="sourceLine" id="cb11-6" title="6"><span class="co">#&#39; @param B number of bootstrips</span></a>
<a class="sourceLine" id="cb11-7" title="7"><span class="co">#&#39; @param cl cluster/integer</span></a>
<a class="sourceLine" id="cb11-8" title="8"><span class="co">#&#39;</span></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="co">#&#39; @return blblm_par</span></a>
<a class="sourceLine" id="cb11-10" title="10"><span class="co">#&#39; @export</span></a>
<a class="sourceLine" id="cb11-11" title="11">blblm_glm_par &lt;-<span class="st"> </span><span class="cf">function</span>(formula, data, <span class="dt">m =</span> m, <span class="dt">B =</span> B,cl) {</a>
<a class="sourceLine" id="cb11-12" title="12">  data_list &lt;-<span class="st"> </span><span class="kw">split_data</span>(data, m)</a>
<a class="sourceLine" id="cb11-13" title="13">  estimates &lt;-<span class="st"> </span><span class="kw">parLapply</span>(cl,data_list,<span class="dt">fun=</span>glm_each_subsample,<span class="dt">formula =</span> formula, <span class="dt">n =</span> <span class="kw">nrow</span>(data), <span class="dt">B =</span> B)</a>
<a class="sourceLine" id="cb11-14" title="14">  res &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">estimates =</span> estimates, <span class="dt">formula =</span> formula)</a>
<a class="sourceLine" id="cb11-15" title="15">  <span class="kw">class</span>(res) &lt;-<span class="st"> &quot;blblm&quot;</span></a>
<a class="sourceLine" id="cb11-16" title="16">  <span class="kw">invisible</span>(res)</a>
<a class="sourceLine" id="cb11-17" title="17">}</a></code></pre></div>
<p>Thus, I finished my improvement. <br> After finish this model with family of gaussian, I know it comes to the end of the project.<br> I did another check() with 0 error, 0 warning, and 0 note. Then, I started doing my test file.<br> I tested the class of the confidence interval and the coefficient, I also tested my blblm_glm and blblm function.<br> I passed these test, and it felt great.<br> In conclusion, I did two parallel function and introduced another model to the package. I fixed typos and potential errors in the package. Untill now, my package still has 0 error, 0 warning, and 0 note. <br> Thank you, and I hope you have a great summer break!</p>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
